# è¯„ä»·ä¸ä¿¡ç”¨ç§¯åˆ†ç³»ç»Ÿå®ç°æ–‡æ¡£

## åŠŸèƒ½æ¦‚è¿°

æœ¬ç³»ç»Ÿå®ç°äº†ç±»ä¼¼é—²é±¼çš„è¯„ä»·ä¸ä¿¡ç”¨ç§¯åˆ†ç³»ç»Ÿï¼ŒåŒ…æ‹¬ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

### 1. è¯„ä»·ç³»ç»Ÿ
- ä¹°å®¶å®Œæˆè®¢å•åå¯ä»¥å¯¹å•†å“å’Œå–å®¶è¿›è¡Œè¯„ä»·
- æ”¯æŒ1-5æ˜Ÿè¯„åˆ†
- æ”¯æŒæ–‡å­—è¯„ä»·å’Œå›¾ç‰‡ä¸Šä¼ 
- æ”¯æŒåŒ¿åè¯„ä»·
- å•†å“è¯¦æƒ…é¡µæ˜¾ç¤ºæ‰€æœ‰è¯„ä»·
- æ¯ä¸ªè®¢å•åªèƒ½è¯„ä»·ä¸€æ¬¡

### 2. ä¿¡ç”¨ç§¯åˆ†ç³»ç»Ÿ
- ä¿¡ç”¨åˆ†è®¡ç®—è§„åˆ™ï¼šåŸºç¡€åˆ†100 + å®Œæˆäº¤æ˜“æ•°Ã—2 + å¹³å‡è¯„åˆ†Ã—20 - å·®è¯„æ•°Ã—10
- äº”ä¸ªä¿¡ç”¨ç­‰çº§ï¼š
  - ç­‰çº§1ï¼šæ–°æ‰‹ï¼ˆæ€»åˆ†<150 æˆ– äº¤æ˜“æ•°<5ï¼‰ğŸŒ±
  - ç­‰çº§2ï¼šé“œç‰Œå–å®¶ï¼ˆæ€»åˆ†â‰¥150 ä¸” äº¤æ˜“æ•°â‰¥5ï¼‰ğŸ¥‰
  - ç­‰çº§3ï¼šé“¶ç‰Œå–å®¶ï¼ˆæ€»åˆ†â‰¥250 ä¸” äº¤æ˜“æ•°â‰¥20 ä¸” å¹³å‡è¯„åˆ†â‰¥3.5ï¼‰ğŸ¥ˆ
  - ç­‰çº§4ï¼šé‡‘ç‰Œå–å®¶ï¼ˆæ€»åˆ†â‰¥400 ä¸” äº¤æ˜“æ•°â‰¥50 ä¸” å¹³å‡è¯„åˆ†â‰¥4.0ï¼‰ğŸ¥‡
  - ç­‰çº§5ï¼šé’»çŸ³å–å®¶ï¼ˆæ€»åˆ†â‰¥600 ä¸” äº¤æ˜“æ•°â‰¥100 ä¸” å¹³å‡è¯„åˆ†â‰¥4.5ï¼‰ğŸ’
- è‡ªåŠ¨ç»Ÿè®¡ï¼šå·²å”®å•†å“æ•°ã€å·²è´­å•†å“æ•°ã€å¥½è¯„ç‡ã€è¯„ä»·è¯¦æƒ…ç­‰

## æ•°æ®åº“è¡¨ç»“æ„

### reviewè¡¨ï¼ˆè¯„ä»·è¡¨ï¼‰
```sql
CREATE TABLE `review` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'è¯„ä»·ID',
    `order_id` INT NOT NULL COMMENT 'è®¢å•ID',
    `product_id` BIGINT NOT NULL COMMENT 'å•†å“ID',
    `buyer_id` INT NOT NULL COMMENT 'ä¹°å®¶ID',
    `seller_id` INT NOT NULL COMMENT 'å–å®¶ID',
    `product_rating` INT NOT NULL COMMENT 'å•†å“è¯„åˆ† 1-5',
    `seller_rating` INT NOT NULL COMMENT 'å–å®¶è¯„åˆ† 1-5',
    `comment` TEXT NULL COMMENT 'è¯„ä»·å†…å®¹',
    `review_images` TEXT NULL COMMENT 'è¯„ä»·å›¾ç‰‡ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”',
    `is_anonymous` BOOLEAN NOT NULL DEFAULT FALSE COMMENT 'æ˜¯å¦åŒ¿åè¯„ä»·',
    `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (`id`),
    UNIQUE INDEX `uk_order_id` (`order_id`)
);
```

### credit_scoreè¡¨ï¼ˆä¿¡ç”¨ç§¯åˆ†è¡¨ï¼‰
```sql
CREATE TABLE `credit_score` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¿¡ç”¨ç§¯åˆ†ID',
    `user_id` BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    `total_score` INT NOT NULL DEFAULT 100 COMMENT 'æ€»ä¿¡ç”¨åˆ†',
    `level` INT NOT NULL DEFAULT 1 COMMENT 'ä¿¡ç”¨ç­‰çº§ 1-5',
    `total_sales` INT NOT NULL DEFAULT 0 COMMENT 'æ€»é”€å”®æ•°',
    `total_purchases` INT NOT NULL DEFAULT 0 COMMENT 'æ€»è´­ä¹°æ•°',
    `average_seller_rating` DOUBLE NOT NULL DEFAULT 0.0 COMMENT 'å¹³å‡å–å®¶è¯„åˆ†',
    `positive_reviews` INT NOT NULL DEFAULT 0 COMMENT 'å¥½è¯„æ•°',
    `neutral_reviews` INT NOT NULL DEFAULT 0 COMMENT 'ä¸­è¯„æ•°',
    `negative_reviews` INT NOT NULL DEFAULT 0 COMMENT 'å·®è¯„æ•°',
    `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (`id`),
    UNIQUE INDEX `uk_user_id` (`user_id`)
);
```

## åç«¯APIæ¥å£

### è¯„ä»·ç›¸å…³æ¥å£

#### 1. åˆ›å»ºè¯„ä»·
```
POST /api/reviews
Authorization: Bearer {token}

Request Body:
{
  "orderId": 1,
  "productRating": 5,      // å•†å“è¯„åˆ† 1-5
  "sellerRating": 5,       // å–å®¶è¯„åˆ† 1-5
  "comment": "å•†å“å¾ˆå¥½",   // è¯„ä»·å†…å®¹ï¼ˆå¯é€‰ï¼‰
  "reviewImages": [],      // è¯„ä»·å›¾ç‰‡URLæ•°ç»„ï¼ˆå¯é€‰ï¼‰
  "isAnonymous": false     // æ˜¯å¦åŒ¿åï¼ˆå¯é€‰ï¼‰
}

Response:
{
  "success": true,
  "message": "è¯„ä»·æˆåŠŸ",
  "data": { ... }
}
```

#### 2. æ£€æŸ¥è®¢å•æ˜¯å¦å·²è¯„ä»·
```
GET /api/reviews/check/{orderId}

Response:
{
  "success": true,
  "hasReviewed": false
}
```

#### 3. è·å–å•†å“çš„æ‰€æœ‰è¯„ä»·
```
GET /api/reviews/product/{productId}

Response:
{
  "success": true,
  "reviews": [ ... ],
  "averageRating": 4.5,
  "totalReviews": 10
}
```

#### 4. è·å–å–å®¶çš„æ‰€æœ‰è¯„ä»·
```
GET /api/reviews/seller/{sellerId}

Response:
{
  "success": true,
  "reviews": [ ... ]
}
```

### ä¿¡ç”¨ç§¯åˆ†ç›¸å…³æ¥å£

#### 1. è·å–ç”¨æˆ·ä¿¡ç”¨åˆ†
```
GET /api/credit-score/{userId}

Response:
{
  "success": true,
  "data": {
    "userId": 1,
    "username": "user123",
    "displayName": "ç”¨æˆ·å",
    "avatarUrl": "...",
    "totalScore": 150,
    "level": 2,
    "levelName": "é“œç‰Œå–å®¶",
    "totalSales": 5,
    "totalPurchases": 3,
    "averageSellerRating": 4.5,
    "positiveReviews": 4,
    "neutralReviews": 1,
    "negativeReviews": 0,
    "totalReviews": 5,
    "positiveRate": 80.0
  }
}
```

#### 2. æ›´æ–°ä¿¡ç”¨åˆ†ï¼ˆç®¡ç†å‘˜æˆ–ç³»ç»Ÿè°ƒç”¨ï¼‰
```
POST /api/credit-score/update/{userId}
Authorization: Bearer {token}

Response:
{
  "success": true,
  "message": "ä¿¡ç”¨åˆ†æ›´æ–°æˆåŠŸ",
  "data": { ... }
}
```

## å‰ç«¯ç»„ä»¶

### 1. ReviewView.vue
è¯„ä»·é¡µé¢ï¼Œç”¨æˆ·åœ¨ç¡®è®¤æ”¶è´§åå¯ä»¥å¯¹è®¢å•è¿›è¡Œè¯„ä»·ã€‚

åŠŸèƒ½ï¼š
- å•†å“è¯„åˆ†ï¼ˆ1-5æ˜Ÿï¼‰
- å–å®¶è¯„åˆ†ï¼ˆ1-5æ˜Ÿï¼‰
- æ–‡å­—è¯„ä»·
- åŒ¿åè¯„ä»·é€‰é¡¹
- æäº¤è¯„ä»·

è·¯ç”±ï¼š`/review/:orderId`

### 2. ProductReviews.vue
å•†å“è¯„ä»·å±•ç¤ºç»„ä»¶ï¼Œæ˜¾ç¤ºåœ¨å•†å“è¯¦æƒ…é¡µã€‚

åŠŸèƒ½ï¼š
- æ˜¾ç¤ºå¹³å‡è¯„åˆ†
- æ˜¾ç¤ºæ‰€æœ‰è¯„ä»·åˆ—è¡¨
- æ˜¾ç¤ºä¹°å®¶ä¿¡æ¯ï¼ˆæˆ–åŒ¿åï¼‰
- æ˜¾ç¤ºè¯„ä»·æ—¶é—´ã€è¯„åˆ†ã€è¯„ä»·å†…å®¹

### 3. CreditScoreCard.vue
ä¿¡ç”¨åˆ†å±•ç¤ºå¡ç‰‡ç»„ä»¶ï¼Œæ˜¾ç¤ºåœ¨å•†å“è¯¦æƒ…é¡µçš„å–å®¶ä¿¡æ¯åŒºåŸŸã€‚

åŠŸèƒ½ï¼š
- æ˜¾ç¤ºå–å®¶ä¿¡ç”¨ç­‰çº§å’Œå›¾æ ‡
- æ˜¾ç¤ºä¿¡ç”¨æ€»åˆ†
- æ˜¾ç¤ºå·²å”®/å·²è´­å•†å“æ•°
- æ˜¾ç¤ºå¥½è¯„ç‡
- æ˜¾ç¤ºè¯„ä»·è¯¦æƒ…ï¼ˆå¥½è¯„/ä¸­è¯„/å·®è¯„åˆ†å¸ƒï¼‰
- æ˜¾ç¤ºå¹³å‡å–å®¶è¯„åˆ†

## ä½¿ç”¨æµç¨‹

### è¯„ä»·æµç¨‹
1. ä¹°å®¶è´­ä¹°å•†å“å¹¶æ”¯ä»˜
2. å–å®¶å‘è´§
3. ä¹°å®¶ç¡®è®¤æ”¶è´§ï¼ˆè®¢å•çŠ¶æ€å˜ä¸ºDELIVEREDï¼‰
4. åœ¨"è®¢å•ä¸­å¿ƒ"æ˜¾ç¤º"â­ è¯„ä»·è®¢å•"æŒ‰é’®
5. ç‚¹å‡»æŒ‰é’®è·³è½¬åˆ°è¯„ä»·é¡µé¢
6. å¡«å†™è¯„åˆ†å’Œè¯„ä»·å†…å®¹
7. æäº¤è¯„ä»·
8. ç³»ç»Ÿè‡ªåŠ¨æ›´æ–°å–å®¶ä¿¡ç”¨åˆ†
9. æŒ‰é’®å˜ä¸º"âœ… å·²è¯„ä»·"ï¼ˆä¸å¯å†æ¬¡è¯„ä»·ï¼‰

### ä¿¡ç”¨åˆ†æ›´æ–°æ—¶æœº
1. ä¹°å®¶ç¡®è®¤æ”¶è´§æ—¶ï¼ˆè‡ªåŠ¨æ›´æ–°ä¹°å®¶å’Œå–å®¶çš„ä¿¡ç”¨åˆ†ï¼‰
2. ä¹°å®¶æäº¤è¯„ä»·åï¼ˆè‡ªåŠ¨æ›´æ–°å–å®¶çš„ä¿¡ç”¨åˆ†ï¼‰
3. ç®¡ç†å‘˜æ‰‹åŠ¨è§¦å‘æ›´æ–°

### å•†å“è¯¦æƒ…é¡µå±•ç¤º
1. å–å®¶ä¿¡ç”¨åˆ†å¡ç‰‡ï¼ˆæ˜¾ç¤ºå–å®¶çš„ä¿¡ç”¨ç­‰çº§ã€è¯„åˆ†ç­‰ï¼‰
2. å•†å“è¯„ä»·åˆ—è¡¨ï¼ˆæ˜¾ç¤ºè¯¥å•†å“çš„æ‰€æœ‰è¯„ä»·ï¼‰

## æ ¸å¿ƒåŠŸèƒ½å®ç°

### åç«¯æ ¸å¿ƒç±»

1. **Entityç±»**
   - `Review.java` - è¯„ä»·å®ä½“
   - `CreditScore.java` - ä¿¡ç”¨ç§¯åˆ†å®ä½“

2. **Mapperæ¥å£**
   - `ReviewMapper.java` - è¯„ä»·æ•°æ®è®¿é—®
   - `CreditScoreMapper.java` - ä¿¡ç”¨ç§¯åˆ†æ•°æ®è®¿é—®

3. **Serviceç±»**
   - `ReviewService.java` / `ReviewServiceImpl.java` - è¯„ä»·ä¸šåŠ¡é€»è¾‘
   - `CreditScoreService.java` / `CreditScoreServiceImpl.java` - ä¿¡ç”¨ç§¯åˆ†ä¸šåŠ¡é€»è¾‘

4. **Controllerç±»**
   - `ReviewController.java` - è¯„ä»·APIæ¥å£
   - `CreditScoreController.java` - ä¿¡ç”¨ç§¯åˆ†APIæ¥å£

5. **DTOç±»**
   - `ReviewRequest.java` - è¯„ä»·è¯·æ±‚
   - `ReviewResponse.java` - è¯„ä»·å“åº”
   - `CreditScoreResponse.java` - ä¿¡ç”¨ç§¯åˆ†å“åº”

### å‰ç«¯æ ¸å¿ƒæ–‡ä»¶

1. **Views**
   - `ReviewView.vue` - è¯„ä»·é¡µé¢

2. **Components**
   - `ProductReviews.vue` - å•†å“è¯„ä»·å±•ç¤ºç»„ä»¶
   - `CreditScoreCard.vue` - ä¿¡ç”¨åˆ†å¡ç‰‡ç»„ä»¶

3. **Router**
   - æ·»åŠ äº† `/review/:orderId` è·¯ç”±

4. **æ›´æ–°çš„æ–‡ä»¶**
   - `ProductDetail.vue` - æ·»åŠ äº†å–å®¶ä¿¡ç”¨åˆ†å’Œå•†å“è¯„ä»·æ˜¾ç¤º
   - `OrderHistory.vue` - æ·»åŠ äº†è¯„ä»·æŒ‰é’®å’Œç›¸å…³é€»è¾‘

## æ³¨æ„äº‹é¡¹

1. **è¯„ä»·è§„åˆ™**
   - åªæœ‰çŠ¶æ€ä¸ºDELIVEREDçš„è®¢å•æ‰èƒ½è¯„ä»·
   - æ¯ä¸ªè®¢å•åªèƒ½è¯„ä»·ä¸€æ¬¡
   - è¯„åˆ†å¿…é¡»åœ¨1-5ä¹‹é—´
   - å¥½è¯„ï¼š4-5æ˜Ÿï¼Œä¸­è¯„ï¼š3æ˜Ÿï¼Œå·®è¯„ï¼š1-2æ˜Ÿ

2. **ä¿¡ç”¨åˆ†è®¡ç®—**
   - æ–°ç”¨æˆ·åˆå§‹ä¿¡ç”¨åˆ†ä¸º100åˆ†
   - å®Œæˆäº¤æ˜“ä¼šå¢åŠ ä¿¡ç”¨åˆ†
   - å·®è¯„ä¼šé™ä½ä¿¡ç”¨åˆ†
   - ä¿¡ç”¨ç­‰çº§æ ¹æ®æ€»åˆ†ã€äº¤æ˜“æ•°ã€å¹³å‡è¯„åˆ†ç»¼åˆè®¡ç®—

3. **æ•°æ®ä¸€è‡´æ€§**
   - è®¢å•ç¡®è®¤æ”¶è´§æ—¶è‡ªåŠ¨æ›´æ–°ä¿¡ç”¨åˆ†
   - æäº¤è¯„ä»·æ—¶è‡ªåŠ¨æ›´æ–°ä¿¡ç”¨åˆ†
   - ä½¿ç”¨äº‹åŠ¡ä¿è¯æ•°æ®ä¸€è‡´æ€§

## æµ‹è¯•å»ºè®®

1. æµ‹è¯•è¯„ä»·åŠŸèƒ½
   - åˆ›å»ºè®¢å• -> æ”¯ä»˜ -> ç¡®è®¤æ”¶è´§ -> è¯„ä»·
   - æµ‹è¯•é‡å¤è¯„ä»·ï¼ˆåº”è¯¥è¢«é˜»æ­¢ï¼‰
   - æµ‹è¯•åŒ¿åè¯„ä»·
   - æµ‹è¯•ä¸åŒè¯„åˆ†å¯¹ä¿¡ç”¨åˆ†çš„å½±å“

2. æµ‹è¯•ä¿¡ç”¨åˆ†ç³»ç»Ÿ
   - æŸ¥çœ‹æ–°ç”¨æˆ·çš„åˆå§‹ä¿¡ç”¨åˆ†
   - å®Œæˆå¤šç¬”äº¤æ˜“åæŸ¥çœ‹ä¿¡ç”¨åˆ†å˜åŒ–
   - æµ‹è¯•ä¸åŒç­‰çº§çš„æ™‹å‡æ¡ä»¶
   - æµ‹è¯•å·®è¯„å¯¹ä¿¡ç”¨åˆ†çš„å½±å“

3. æµ‹è¯•å‰ç«¯å±•ç¤º
   - å•†å“è¯¦æƒ…é¡µæ˜¯å¦æ­£ç¡®æ˜¾ç¤ºå–å®¶ä¿¡ç”¨åˆ†
   - å•†å“è¯¦æƒ…é¡µæ˜¯å¦æ­£ç¡®æ˜¾ç¤ºè¯„ä»·åˆ—è¡¨
   - è®¢å•ä¸­å¿ƒæ˜¯å¦æ­£ç¡®æ˜¾ç¤ºè¯„ä»·æŒ‰é’®
   - è¯„ä»·é¡µé¢åŠŸèƒ½æ˜¯å¦å®Œæ•´

## å·²å®Œæˆçš„æ–‡ä»¶

### åç«¯æ–‡ä»¶ï¼ˆJavaï¼‰
âœ… `/src/main/java/lut/cn/c2cplatform/entity/Review.java`
âœ… `/src/main/java/lut/cn/c2cplatform/entity/CreditScore.java`
âœ… `/src/main/java/lut/cn/c2cplatform/mapper/ReviewMapper.java`
âœ… `/src/main/java/lut/cn/c2cplatform/mapper/CreditScoreMapper.java`
âœ… `/src/main/java/lut/cn/c2cplatform/mapper/OrderMapper.java` (å·²ä¿®å¤)
âœ… `/src/main/java/lut/cn/c2cplatform/dto/ReviewRequest.java`
âœ… `/src/main/java/lut/cn/c2cplatform/dto/ReviewResponse.java`
âœ… `/src/main/java/lut/cn/c2cplatform/dto/CreditScoreResponse.java`
âœ… `/src/main/java/lut/cn/c2cplatform/service/ReviewService.java`
âœ… `/src/main/java/lut/cn/c2cplatform/service/CreditScoreService.java`
âœ… `/src/main/java/lut/cn/c2cplatform/service/impl/ReviewServiceImpl.java`
âœ… `/src/main/java/lut/cn/c2cplatform/service/impl/CreditScoreServiceImpl.java`
âœ… `/src/main/java/lut/cn/c2cplatform/service/impl/OrderServiceImpl.java` (å·²æ›´æ–°)
âœ… `/src/main/java/lut/cn/c2cplatform/controller/ReviewController.java`
âœ… `/src/main/java/lut/cn/c2cplatform/controller/CreditScoreController.java`

### å‰ç«¯æ–‡ä»¶ï¼ˆVueï¼‰
âœ… `/frontend/src/views/ReviewView.vue`
âœ… `/frontend/src/components/ProductReviews.vue`
âœ… `/frontend/src/components/CreditScoreCard.vue`
âœ… `/frontend/src/views/ProductDetail.vue` (å·²æ›´æ–°)
âœ… `/frontend/src/views/OrderHistory.vue` (å·²æ›´æ–°)
âœ… `/frontend/src/router/index.js` (å·²æ›´æ–°)

### æ•°æ®åº“æ–‡ä»¶
âœ… `/init.sql` (å·²æ·»åŠ reviewå’Œcredit_scoreè¡¨)

## æ€»ç»“

è¯„ä»·ä¸ä¿¡ç”¨ç§¯åˆ†ç³»ç»Ÿå·²ç»å®Œæ•´å®ç°ï¼ŒåŒ…æ‹¬ï¼š
- âœ… å®Œæ•´çš„è¯„ä»·åŠŸèƒ½ï¼ˆåˆ›å»ºã€æŸ¥è¯¢ã€å±•ç¤ºï¼‰
- âœ… ä¿¡ç”¨ç§¯åˆ†ç³»ç»Ÿï¼ˆè‡ªåŠ¨è®¡ç®—ã€ç­‰çº§åˆ’åˆ†ï¼‰
- âœ… å‰ç«¯UIç»„ä»¶ï¼ˆè¯„ä»·é¡µé¢ã€è¯„ä»·åˆ—è¡¨ã€ä¿¡ç”¨åˆ†å¡ç‰‡ï¼‰
- âœ… æ•°æ®åº“è¡¨ç»“æ„
- âœ… å®Œæ•´çš„APIæ¥å£
- âœ… è‡ªåŠ¨æ›´æ–°æœºåˆ¶

ç³»ç»Ÿå®Œå…¨å‚ç…§é—²é±¼çš„è®¾è®¡ï¼Œæä¾›äº†å®Œå–„çš„ç”¨æˆ·ä¿¡ç”¨ä½“ç³»å’Œè¯„ä»·ç³»ç»Ÿã€‚

