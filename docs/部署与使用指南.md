# c2csectradeæ™ºèƒ½äºŒæ‰‹å•†å“äº¤æ˜“å¹³å° - éƒ¨ç½²ä¸ä½¿ç”¨æŒ‡å—

## ç³»ç»Ÿæ¦‚è¿°

c2csecTrade æ˜¯ä¸€ä¸ªå®Œæ•´çš„**åˆ†å¸ƒå¼äºŒæ‰‹å•†å“äº¤æ˜“å¹³å°**ï¼Œæ”¯æŒæ•°ç äº§å“ã€æœè£…é‹åŒ…ã€å›¾ä¹¦ã€å®¶å±…ç”Ÿæ´»ã€è¿åŠ¨æˆ·å¤–ç­‰å¤šå“ç±»äº¤æ˜“ã€‚ç³»ç»Ÿå·²å®Œæˆä»å•ä½“åº”ç”¨åˆ°åˆ†å¸ƒå¼æ¶æ„çš„å…¨é¢å‡çº§ï¼Œé›†æˆäº†å¤šç§å…ˆè¿›æŠ€æœ¯ï¼š

### æ ¸å¿ƒæŠ€æœ¯æ ˆ
- **åç«¯æ¡†æ¶**: Spring Boot 3.2.3
- **æ•°æ®åº“**: MySQL 8.0 (ä¸»ä»å¤åˆ¶æ”¯æŒ)
- **ç¼“å­˜**: Redis 7 (åˆ†å¸ƒå¼ç¼“å­˜ + ä¼šè¯ç®¡ç†)
- **æ¶ˆæ¯é˜Ÿåˆ—**: RabbitMQ 3.12 (äº‹ä»¶é©±åŠ¨æ¶æ„)
- **æœç´¢å¼•æ“**: Elasticsearch 8.11
- **å¯¹è±¡å­˜å‚¨**: MinIO
- **å‰ç«¯æ¡†æ¶**: Vue.js 3
- **å®¹å™¨åŒ–**: Docker + Docker Compose

### é«˜çº§æ¨èç³»ç»Ÿç‰¹æ€§
âœ… **ååŒè¿‡æ»¤** (Item-Based CF)
âœ… **åŸºäºå†…å®¹æ¨è** (TF-IDF + ä½™å¼¦ç›¸ä¼¼åº¦)
âœ… **æ··åˆæ¨è** (Hybrid: CF + Content + Popularity)
âœ… **ç¥ç»ç½‘ç»œååŒè¿‡æ»¤** (NCF: GMF + MLP)
âœ… **å®æ—¶æ¨è** (Real-time Stream Processing)
âœ… **A/Bæµ‹è¯•æ¡†æ¶** (Multi-variant Testing)
âœ… **å¤šç›®æ ‡ä¼˜åŒ–** (CTR + CVR + Revenue + Diversity)

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- **Docker**: 20.10+
- **Docker Compose**: 2.0+
- **JDK**: 17+
- **Node.js**: 16+ (å¼€å‘ç¯å¢ƒ)
- **å†…å­˜**: æœ€å°‘ 8GB (æ¨è 16GB)
- **ç£ç›˜**: 20GB+

### 2. ä¸€é”®å¯åŠ¨ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

**æ¨èæ–¹å¼ - ä½¿ç”¨ä¿®å¤åçš„å¯åŠ¨è„šæœ¬ï¼š**
```bash
# å…‹éš†é¡¹ç›®
cd /Users/Kiyu/IdeaProjects/temaple/rebooktrade

# ä½¿ç”¨å®Œæ•´å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰â­
./scripts/start-fixed.sh

# æˆ–ä½¿ç”¨ Makefile
make up
```

**æ‰‹åŠ¨å¯åŠ¨æ–¹å¼ï¼š**
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker compose ps

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f backend
```

**å¯åŠ¨è„šæœ¬åŠŸèƒ½ï¼š**
- âœ… è‡ªåŠ¨æ£€æŸ¥å¹¶å®‰è£…å‰ç«¯ä¾èµ–ï¼ˆåŒ…æ‹¬WebSocketåº“ï¼‰
- âœ… æ„å»ºåç«¯Mavené¡¹ç›®
- âœ… æ„å»ºå‰ç«¯Vue.jsåº”ç”¨
- âœ… åœæ­¢ç°æœ‰å®¹å™¨é¿å…å†²çª
- âœ… å¯åŠ¨æ‰€æœ‰DockeræœåŠ¡
- âœ… æ˜¾ç¤ºæœåŠ¡çŠ¶æ€å’Œè®¿é—®åœ°å€

### 3. æœåŠ¡è®¿é—®åœ°å€

- **å‰ç«¯**: http://localhost:80
- **åç«¯API**: http://localhost:8080
- **RabbitMQç®¡ç†ç•Œé¢**: http://localhost:15672 (admin/admin123)
- **MinIOæ§åˆ¶å°**: http://localhost:9001 (minioadmin/minioadmin)
- **Elasticsearch**: http://localhost:9200

### 4. æœ¬åœ°å¼€å‘ç¯å¢ƒ

```bash
# å¯åŠ¨ä¾èµ–æœåŠ¡ï¼ˆMySQL, Redis, RabbitMQç­‰ï¼‰
docker-compose up -d mysql redis rabbitmq elasticsearch minio

# åç«¯å¼€å‘
cd /Users/Kiyu/IdeaProjects/temaple/rebooktrade
mvn clean install
mvn spring-boot:run

# å‰ç«¯å¼€å‘
cd frontend
npm install
npm run serve
```

## æ¨èç³»ç»Ÿä½¿ç”¨æŒ‡å—

### 1. åˆå§‹åŒ–æ¨èç³»ç»Ÿ

ç³»ç»Ÿé¦–æ¬¡å¯åŠ¨æ—¶ï¼Œä¼šè‡ªåŠ¨åˆå§‹åŒ–æ¨èæ¨¡å‹ã€‚ä¹Ÿå¯ä»¥æ‰‹åŠ¨è§¦å‘ï¼š

```bash
# ç®¡ç†å‘˜è´¦å·ç™»å½•åè°ƒç”¨
curl -X POST http://localhost:8080/api/recommendations/compute \
  -H "Authorization: Bearer <admin-token>"
```

### 2. A/Bæµ‹è¯•é…ç½®

ç³»ç»Ÿé»˜è®¤å·²é…ç½®5ä¸ªæ¨èç®—æ³•å˜ä½“ï¼š

- **Control (20%)**: ååŒè¿‡æ»¤
- **Variant A (20%)**: åŸºäºå†…å®¹
- **Variant B (20%)**: æ··åˆæ¨è
- **Variant C (20%)**: NCFç¥ç»ç½‘ç»œ
- **Variant D (20%)**: å®æ—¶æ¨è

ç”¨æˆ·ä¼šæ ¹æ®IDè‡ªåŠ¨åˆ†é…åˆ°ä¸åŒå˜ä½“ç»„ï¼Œç³»ç»Ÿä¼šè¿½è¸ªå„ç»„çš„æ€§èƒ½æŒ‡æ ‡ã€‚

### 3. æŸ¥çœ‹A/Bæµ‹è¯•ç»“æœ

```bash
# è·å–å®éªŒç»“æœ
curl http://localhost:8080/api/recommendations/abtest/results/recommendation_algorithm_v1
```

å“åº”ç¤ºä¾‹ï¼š
```json
{
  "control": {
    "impressions": 10000,
    "clicks": 250,
    "conversions": 25,
    "ctr": 0.025,
    "cvr": 0.1,
    "totalRevenue": 2500.0
  },
  "variant_c": {
    "impressions": 10000,
    "clicks": 320,
    "conversions": 35,
    "ctr": 0.032,
    "cvr": 0.109,
    "totalRevenue": 3500.0
  }
}
```

### 4. å®æ—¶æ¨èè¿½è¸ª

ç”¨æˆ·çš„æ¯æ¬¡äº¤äº’éƒ½ä¼šè¢«å®æ—¶å¤„ç†ï¼š

```javascript
// å‰ç«¯è‡ªåŠ¨è¿½è¸ª
// å•†å“æµè§ˆ
axios.post('/api/history/view', { productId: 123 });

// åŠ å…¥æ”¶è—
axios.post('/api/favorites/add/123');

// åŠ å…¥è´­ç‰©è½¦
axios.post('/api/cart/add', { productId: 123, quantity: 1 });
```

åç«¯è‡ªåŠ¨ï¼š
- æ›´æ–°ç”¨æˆ·å…´è¶£ç”»åƒ
- è®­ç»ƒNCFæ¨¡å‹
- æ›´æ–°çƒ­åº¦åˆ†æ•°
- å‘å¸ƒåˆ°æ¶ˆæ¯é˜Ÿåˆ—

## Redisä½¿ç”¨è¯´æ˜

### å…³é”®æ•°æ®ç»“æ„

```
# ç”¨æˆ·æµè§ˆå†å²
history:user:{userId} -> Sorted Set (score=timestamp)

# ç”¨æˆ·å…´è¶£ç”»åƒ
profile:user:{userId} -> Hash (tag -> score)

# ååŒè¿‡æ»¤æ¨è
recommend:item-cf:{productId} -> Sorted Set (score=similarity)

# å†…å®¹ç›¸ä¼¼åº¦
recommend:content:{productId} -> Sorted Set (score=similarity)

# å•†å“çƒ­åº¦
recommend:popularity -> Sorted Set (score=popularity)

# NCFæ¨¡å‹å‚æ•°
ncf:embedding:user:{userId} -> Array[32]
ncf:embedding:item:{productId} -> Array[32]

# å®æ—¶ä¼šè¯
realtime:session:{userId} -> List (æœ€è¿‘20æ¬¡äº¤äº’)

# å®æ—¶è¶‹åŠ¿
realtime:trending -> Sorted Set (score=timestamp)

# A/Bæµ‹è¯•åˆ†ç»„
abtest:user:{experimentId}:{userId} -> String (variant)

# åˆ†å¸ƒå¼é”
lock:{resource} -> String (lockId)
```

### Redisç›‘æ§

```bash
# æŸ¥çœ‹RedisçŠ¶æ€
docker exec rebooktrade-redis redis-cli INFO

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
docker exec rebooktrade-redis redis-cli INFO memory

# æŸ¥çœ‹é”®æ•°é‡
docker exec rebooktrade-redis redis-cli DBSIZE

# æŸ¥çœ‹æ…¢æŸ¥è¯¢
docker exec rebooktrade-redis redis-cli SLOWLOG GET 10
```

## RabbitMQæ¶ˆæ¯é˜Ÿåˆ—

### äº¤æ¢æœºå’Œé˜Ÿåˆ—

**è®¢å•äº¤æ¢æœº** (order.exchange):
- `order.paid.queue` - è®¢å•æ”¯ä»˜æˆåŠŸ
- `order.canceled.queue` - è®¢å•å–æ¶ˆ
- `order.completed.queue` - è®¢å•å®Œæˆ

**é€šçŸ¥äº¤æ¢æœº** (notification.exchange):
- `notification.email.queue` - é‚®ä»¶é€šçŸ¥
- `notification.system.queue` - ç³»ç»Ÿæ¶ˆæ¯

**æ¨èäº¤æ¢æœº** (recommendation.exchange):
- `recommendation.update.queue` - æ¨èæ›´æ–°

**å•†å“äº¤æ¢æœº** (product.exchange):
- `product.created.queue` - å•†å“åˆ›å»º
- `product.stock.low.queue` - åº“å­˜ä¸è¶³

### æ¶ˆæ¯ç¤ºä¾‹

```java
// å‘å¸ƒè®¢å•æ”¯ä»˜äº‹ä»¶
OrderPaidEvent event = new OrderPaidEvent(
    orderId, userId, amount, "alipay", new Date()
);
eventPublisher.publishOrderPaid(event);

// æ¶ˆè´¹è€…è‡ªåŠ¨å¤„ç†
@RabbitListener(queues = "order.paid.queue")
public void handleOrderPaid(OrderPaidEvent event) {
    // å‘é€é€šçŸ¥
    // æ›´æ–°æ¨è
    // è®°å½•æ—¥å¿—
}
```

### RabbitMQç®¡ç†

è®¿é—®ç®¡ç†ç•Œé¢: http://localhost:15672

- ç”¨æˆ·å: admin
- å¯†ç : admin123

å¯ä»¥æŸ¥çœ‹ï¼š
- é˜Ÿåˆ—æ¶ˆæ¯å †ç§¯
- æ¶ˆè´¹é€Ÿç‡
- æ¶ˆæ¯ååé‡

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. Redisä¼˜åŒ–

```properties
# å¢åŠ è¿æ¥æ± 
spring.data.redis.lettuce.pool.max-active=20
spring.data.redis.lettuce.pool.max-idle=10

# å¯ç”¨Pipeline
# æ‰¹é‡æ“ä½œæ—¶ä½¿ç”¨redisCacheService.batchSet()
```

### 2. RabbitMQä¼˜åŒ–

```properties
# å¢åŠ é¢„å–æ•°é‡
spring.rabbitmq.listener.simple.prefetch=10

# å¯ç”¨æ¶ˆè´¹è€…å¹¶å‘
spring.rabbitmq.listener.simple.concurrency=5
spring.rabbitmq.listener.simple.max-concurrency=10
```

### 3. æ•°æ®åº“ä¼˜åŒ–

```sql
-- æ·»åŠ ç´¢å¼•
CREATE INDEX idx_product_category ON pms_product(category);
CREATE INDEX idx_product_status_stock ON pms_product(status, stock);
CREATE INDEX idx_product_created_at ON pms_product(created_at);

-- å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®
DELETE FROM browsing_history WHERE created_at < DATE_SUB(NOW(), INTERVAL 90 DAY);
```

### 4. æ¨èç³»ç»Ÿä¼˜åŒ–

```bash
# è°ƒæ•´æ¨èè®¡ç®—é¢‘ç‡ï¼ˆæ ¹æ®å•†å“æ•°é‡ï¼‰
# å•†å“ < 1000: æ¯å°æ—¶
# å•†å“ 1000-10000: æ¯6å°æ—¶
# å•†å“ > 10000: æ¯å¤©

# è°ƒæ•´å€™é€‰é›†å¤§å°
# ååŒè¿‡æ»¤: Top 50
# å†…å®¹ç›¸ä¼¼åº¦: Top 50
# å®æ—¶æ¨è: Top 30
```

## ç›‘æ§å’Œå‘Šè­¦

### 1. åº”ç”¨ç›‘æ§

```bash
# æŸ¥çœ‹å¥åº·çŠ¶æ€
curl http://localhost:8080/actuator/health

# æŸ¥çœ‹æŒ‡æ ‡
curl http://localhost:8080/actuator/metrics
```

### 2. æ—¥å¿—æŸ¥çœ‹

```bash
# åº”ç”¨æ—¥å¿—
docker-compose logs -f backend

# Redisæ—¥å¿—
docker-compose logs -f redis

# RabbitMQæ—¥å¿—
docker-compose logs -f rabbitmq
```

### 3. æ€§èƒ½æŒ‡æ ‡

ç›‘æ§ä»¥ä¸‹å…³é”®æŒ‡æ ‡ï¼š
- **QPS**: æ¯ç§’æŸ¥è¯¢æ•°
- **å“åº”æ—¶é—´**: P50, P95, P99
- **é”™è¯¯ç‡**: 4xx, 5xxé”™è¯¯
- **ç¼“å­˜å‘½ä¸­ç‡**: > 95%
- **æ¶ˆæ¯å †ç§¯**: < 1000

## æ•…éšœæ’æŸ¥

### é—®é¢˜1: æ¨èç»“æœä¸ºç©º

**åŸå› **: åˆå§‹æ•°æ®ä¸è¶³æˆ–è®¡ç®—æœªå®Œæˆ

**è§£å†³**:
```bash
# æ£€æŸ¥Redisä¸­æ˜¯å¦æœ‰æ¨èæ•°æ®
docker exec rebooktrade-redis redis-cli KEYS "recommend:*"

# æ‰‹åŠ¨è§¦å‘è®¡ç®—
curl -X POST http://localhost:8080/api/recommendations/compute \
  -H "Authorization: Bearer <admin-token>"
```

### é—®é¢˜2: RabbitMQæ¶ˆæ¯å †ç§¯

**åŸå› **: æ¶ˆè´¹è€…å¤„ç†é€Ÿåº¦æ…¢

**è§£å†³**:
```bash
# å¢åŠ æ¶ˆè´¹è€…å¹¶å‘æ•°
# åœ¨application.propertiesä¸­è°ƒæ•´
spring.rabbitmq.listener.simple.concurrency=10

# æˆ–ä¸´æ—¶æ¸…ç©ºé˜Ÿåˆ—ï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰
docker exec rebooktrade-rabbitmq rabbitmqctl purge_queue order.paid.queue
```

### é—®é¢˜3: Rediså†…å­˜æº¢å‡º

**åŸå› **: ç¼“å­˜æ•°æ®è¿‡å¤š

**è§£å†³**:
```bash
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
docker exec rebooktrade-redis redis-cli INFO memory

# æ¸…ç†è¿‡æœŸé”®
docker exec rebooktrade-redis redis-cli --scan --pattern "cache:*" | xargs redis-cli DEL

# è®¾ç½®æœ€å¤§å†…å­˜é™åˆ¶
docker exec rebooktrade-redis redis-cli CONFIG SET maxmemory 2gb
docker exec rebooktrade-redis redis-cli CONFIG SET maxmemory-policy allkeys-lru
```

## æ‰©å±•éƒ¨ç½²

### æ°´å¹³æ‰©å±•

```bash
# æ‰©å±•åç«¯å®ä¾‹åˆ°3ä¸ª
docker-compose up -d --scale backend=3

# é…ç½®Nginxè´Ÿè½½å‡è¡¡
# ç¼–è¾‘nginx.conf
upstream backend {
    server backend1:8080;
    server backend2:8080;
    server backend3:8080;
}
```

### Redisé›†ç¾¤

```yaml
# docker-compose.yml
redis-master:
  image: redis:7-alpine
  
redis-slave-1:
  image: redis:7-alpine
  command: redis-server --slaveof redis-master 6379
  
redis-slave-2:
  image: redis:7-alpine
  command: redis-server --slaveof redis-master 6379
```

## å®‰å…¨å»ºè®®

1. **ä¿®æ”¹é»˜è®¤å¯†ç **
   - MySQL: rootå¯†ç 
   - RabbitMQ: adminå¯†ç 
   - Redis: å¯ç”¨å¯†ç è®¤è¯

2. **å¯ç”¨HTTPS**
   ```bash
   # ä½¿ç”¨Let's Encryptè·å–è¯ä¹¦
   certbot certonly --standalone -d yourdomain.com
   ```

3. **é™æµé…ç½®**
   ```java
   // ä½¿ç”¨Rediså®ç°é™æµ
   Long count = redisCacheService.incrementWithExpire(
       "ratelimit:user:" + userId, 60
   );
   if (count > 100) {
       throw new RateLimitException();
   }
   ```

4. **æ•°æ®å¤‡ä»½**
   ```bash
   # MySQLå¤‡ä»½
   docker exec rebooktrade-mysql mysqldump -uroot -p trade > backup.sql
   
   # Rediså¤‡ä»½
   docker exec rebooktrade-redis redis-cli BGSAVE
   ```

## æ€»ç»“

ç³»ç»Ÿå·²å®Œæˆï¼š
âœ… ä¿®å¤æ‰€æœ‰ç¼–è¯‘é”™è¯¯
âœ… æ·±åº¦é›†æˆRedisï¼ˆç¼“å­˜ã€é”ã€å¸ƒéš†è¿‡æ»¤å™¨ï¼‰
âœ… å¼•å…¥RabbitMQæ¶ˆæ¯é˜Ÿåˆ—
âœ… å®ç°ç¥ç»ç½‘ç»œååŒè¿‡æ»¤ï¼ˆNCFï¼‰
âœ… å®ç°å®æ—¶æ¨èç³»ç»Ÿ
âœ… å®ç°A/Bæµ‹è¯•æ¡†æ¶
âœ… å®ç°å¤šç›®æ ‡ä¼˜åŒ–
âœ… å®Œæ•´çš„åˆ†å¸ƒå¼æ¶æ„
âœ… ç”Ÿäº§çº§é…ç½®å’Œç›‘æ§

ç³»ç»Ÿå·²ç»å…·å¤‡ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²èƒ½åŠ›ï¼ğŸ‰

