# 举报功能文档

## 功能概述

举报功能是维护平台内容健康和交易安全的重要机制。它允许用户对涉嫌违规的商品、用户或行为进行举报，并由平台管理员进行审核和处理。该功能旨在建立社区监督体系，共同营造一个可信的交易环境。

### 核心功能
- **发起举报**：用户可以在商品详情页或其他相关页面，通过举报按钮弹出一个模态框来提交举报。
- **选择举报类型**：用户需要选择一个预设的举报理由，如“违禁品”、“欺诈行为”、“虚假信息”等。
- **补充举报描述**：用户可以额外填写文字描述，为管理员提供更详细的背景信息。
- **管理员审核**：管理员拥有一个专门的后台页面，可以查看所有待处理的举报。
- **处理举报**：管理员可以审核举报内容，并根据情况采取相应措施，如“下架商品”、“封禁用户”等，并标记举报为“已处理”或“无效举报”。

## 数据库表结构

### report表（举报表）
```sql
CREATE TABLE `report` (
  `id` int NOT NULL AUTO_INCREMENT COMMENT '举报ID',
  `reporter_id` int NOT NULL COMMENT '举报人ID',
  `reported_user_id` int DEFAULT NULL COMMENT '被举报用户ID',
  `reported_product_id` int DEFAULT NULL COMMENT '被举报商品ID',
  `report_type` varchar(100) NOT NULL COMMENT '举报类型',
  `description` text COMMENT '举报描述',
  `status` varchar(20) DEFAULT 'PENDING' COMMENT '状态 (PENDING, RESOLVED, INVALID)',
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `reporter_id` (`reporter_id`),
  KEY `reported_user_id` (`reported_user_id`),
  KEY `reported_product_id` (`reported_product_id`),
  CONSTRAINT `report_ibfk_1` FOREIGN KEY (`reporter_id`) REFERENCES `user` (`id`),
  CONSTRAINT `report_ibfk_2` FOREIGN KEY (`reported_user_id`) REFERENCES `user` (`id`),
  CONSTRAINT `report_ibfk_3` FOREIGN KEY (`reported_product_id`) REFERENCES `product` (`id`)
);
```

## 后端API接口

### 用户端接口

#### 1. 创建举报
`POST /api/reports`
- **Authorization**: `Bearer {token}`
- **Request Body**: `{ "reportedProductId": 123, "reportType": "违禁品", "description": "..." }`
- **Response**: 成功或失败的消息。

### 管理员端接口

#### 1. 获取所有举报
`GET /api/admin/reports`
- **Authorization**: `Bearer {admin-token}`
- **Query Params**: `status=PENDING` (可选，用于筛选)
- **Response**: 返回举报列表，包含举报人、被举报对象等详细信息。

#### 2. 更新举报状态
`PUT /api/admin/reports/{reportId}/status`
- **Authorization**: `Bearer {admin-token}`
- **Request Body**: `{ "status": "RESOLVED" }`
- **Response**: 成功或失败的消息。

## 前端视图与组件

- **ReportModal.vue**: 举报模态框组件。
  - 这是一个可复用的组件，可以在任何需要举报功能的地方被调用。
  - 内部包含一个表单，让用户选择举报类型并填写描述。
  - 点击“提交”时，调用 `POST /api/reports` 接口。

- **AdminReports.vue**: 管理员的举报管理页面。
  - 路由: `/admin/reports`
  - 功能：
    - 以表格或列表形式展示所有举报信息。
    - 提供筛选功能，可以按“待处理”、“已处理”等状态查看。
    - 每一行举报信息都包含查看详情和处理操作的按钮。
    - 管理员点击“处理”后，可以更新该举报的状态。

- **FloatingReportsButton.vue**: (管理员专属)全局悬浮按钮。
  - 仅当登录用户是管理员时显示。
  - 可以显示当前待处理的举报数量。
  - 作为进入 `AdminReports.vue` 页面的快捷入口。

## 使用流程

### 用户举报流程
1.  用户在商品详情页 (`ProductDetail.vue`) 或用户个人主页 (`UserProductsView.vue`) 点击“举报”按钮。
2.  前端弹出一个模态框 (`ReportModal.vue`)。
3.  用户在模态框中选择举报类型，并可选择性地填写详细描述。
4.  用户点击“提交”按钮。
5.  `ReportModal.vue` 组件调用 `POST /api/reports` 接口，将举报信息发送到后端。
6.  后端 `ReportService.java` 将举报信息存入 `report` 表，初始状态为 `PENDING`。
7.  前端收到成功响应后，关闭模态框并向用户显示“举报成功”的提示。

### 管理员处理流程
1.  管理员登录系统，看到 `FloatingReportsButton.vue` 上显示的待处理举报数量。
2.  管理员点击按钮或通过导航进入 `/admin/reports` 页面 (`AdminReports.vue`)。
3.  页面加载时，调用 `GET /api/admin/reports` 接口（默认筛选 `status=PENDING`），获取所有待处理的举报并展示。
4.  管理员审查每个举报的详细信息，包括举报理由、描述，并可以点击链接查看被举报的商品或用户信息。
5.  根据审查结果，管理员执行相应操作（如在商品管理页面下架商品，或在用户管理页面封禁用户）。
6.  操作完成后，管理员在该举报项上点击“标记为已处理”或“标记为无效”。
7.  前端调用 `PUT /api/admin/reports/{reportId}/status` 接口，将该举报的状态更新为 `RESOLVED` 或 `INVALID`。
8.  该条举报记录将从“待处理”列表中消失。

## 核心功能实现

### 后端
- **Report.java**: 举报实体的定义。
- **ReportMapper.java**: MyBatis Mapper接口，用于数据库操作。
- **ReportService.java**: 封装举报相关的业务逻辑。
- **ReportController.java**: 处理用户提交举报的API端点。
- **AdminController.java** (或单独的 **AdminReportController.java**): 处理管理员获取和更新举报的API端点。

### 前端
- **全局状态管理 (Vuex)**: 可以使用Vuex来控制 `ReportModal.vue` 的显示和隐藏，并向其传递需要举报的对象ID（如 `productId`）。
- **组件化**: `ReportModal.vue` 被设计成一个高度独立的组件，父组件只需控制其可见性并监听其提交事件即可。
- **权限控制**: `AdminReports.vue` 页面和 `FloatingReportsButton.vue` 组件通过路由守卫和 `v-if` 指令，确保只有管理员角色的用户才能访问和看到。
