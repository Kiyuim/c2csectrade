# 砍价功能测试指南

## 功能概述
砍价功能允许用户发起砍价活动，邀请好友帮忙砍价，直到达到目标价格后可以以优惠价购买商品。

## 如何模拟砍价成功

### 方法一：多账号助力（推荐）

1. **发起砍价**
   - 登录账号A
   - 浏览商品详情页
   - 点击"🔪 砍价购买"按钮
   - 系统会自动创建砍价活动并跳转到砍价页面

2. **邀请好友助力**
   - 复制砍价链接（点击"📤 分享给好友"按钮）
   - 登出账号A

3. **好友帮忙砍价**
   - 登录账号B
   - 在浏览器中打开砍价链接
   - 点击"🎁 帮TA砍一刀"按钮
   - 系统会随机砍掉一定金额

4. **继续邀请更多好友**
   - 重复步骤3，使用账号C、D、E等
   - 每个账号每次砍价会随机减少价格
   - 当当前价格 <= 目标价格时，砍价成功！

5. **砍价成功后**
   - 页面会显示"🎉 砍价成功！"
   - 点击"💰 立即购买"按钮
   - 可以以砍价后的价格购买商品

### 方法二：调整后端参数（开发测试）

如果想快速测试砍价成功，可以修改后端参数：

1. **修改砍价幅度**
   - 打开 `BargainService.java`
   - 找到 `helpBargain` 方法中的砍价金额计算逻辑
   - 增大每次砍价的金额，例如：
   ```java
   // 修改前：每次随机砍 0.01-1.00 元
   BigDecimal cutAmount = BigDecimal.valueOf(0.01 + Math.random() * 0.99);
   
   // 修改后：每次随机砍 5-20 元（更容易成功）
   BigDecimal cutAmount = BigDecimal.valueOf(5 + Math.random() * 15);
   ```

2. **减少所需助力次数**
   - 修改目标价格，让原价和目标价相差较小
   - 例如：原价100元，目标价95元，只需砍掉5元即可

3. **调整活动时长**
   - 在 `startBargain` 方法中修改过期时间
   ```java
   // 默认24小时
   expireTime = LocalDateTime.now().plusHours(24);
   
   // 可以改为更长时间，方便测试
   expireTime = LocalDateTime.now().plusDays(7);
   ```

### 方法三：直接修改数据库（快速测试）

最快的测试方法是直接修改数据库：

1. 连接到数据库
2. 找到你的砍价活动记录
3. 执行SQL：
```sql
-- 假设砍价活动ID为1
UPDATE bargain_activity 
SET current_price = target_price, 
    status = 'SUCCESS' 
WHERE id = 1;
```

4. 刷新砍价页面，即可看到成功状态

## 砍价逻辑说明

### 价格计算
- **原价（originalPrice）**：商品的原始价格
- **目标价（targetPrice）**：砍价成功后的价格（通常是原价的70-90%）
- **当前价（currentPrice）**：实时价格，每次助力后会减少

### 成功条件
```
当前价格 <= 目标价格 时，砍价成功
```

### 助力规则
1. 每个用户每个砍价活动只能助力一次
2. 每次助力随机减少一定金额
3. 活动发起者本人不能为自己助力
4. 活动过期或成功后不能再助力

### 状态流转
```
ONGOING（进行中） → SUCCESS（成功） 或 EXPIRED（已过期）
```

## 前端页面特性

### 砍价按钮样式
- 渐变背景色（红橙色）
- 悬停时有阴影和上浮效果
- 点击时有波纹动画
- 显示刀具emoji图标

### 砍价页面展示
- 实时显示当前价格
- 进度条显示砍价进度
- 助力列表显示所有帮忙的好友
- 倒计时显示剩余时间
- 成功后显示购买按钮

## 测试建议

### 完整测试流程
1. 准备3-5个测试账号
2. 用账号1发起砍价
3. 依次用其他账号助力
4. 观察价格变化和进度条
5. 验证成功后的购买流程

### 边界情况测试
- [ ] 自己能否为自己助力（应该不行）
- [ ] 同一用户能否多次助力（应该不行）
- [ ] 活动过期后能否助力（应该不行）
- [ ] 已成功的活动能否继续助力（应该不行）
- [ ] 游客能否参与助力（取决于实现）

## 常见问题

**Q: 为什么点击"帮TA砍一刀"没反应？**
A: 检查：
- 是否已经助力过这个活动
- 是否是活动发起者本人
- 活动是否已过期或已成功
- 浏览器控制台是否有错误

**Q: 如何查看所有砍价活动？**
A: 可以添加一个砍价列表页面，显示用户参与的所有砍价活动

**Q: 砍价成功后如何购买？**
A: 点击"立即购买"按钮会跳转到商品详情页，可以按砍价后的价格购买

## 开发提示

如果需要调试，可以在浏览器控制台查看：
```javascript
// 查看当前砍价活动数据
console.log(bargainActivity.value)

// 查看助力列表
console.log(helpList.value)

// 查看是否是活动发起者
console.log(isOwner.value)
```

